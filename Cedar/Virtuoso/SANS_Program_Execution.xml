<form theme="dark">
  <label>Program Execution</label>
  <description>SANS Windows Artifact Analysis - https://www.sans.org/security-resources/posters/windows-forensic-analysis/170/download</description>
  <fieldset submitButton="true">
    <input type="dropdown" token="evidence_file">
      <label>Evidence File:</label>
      <fieldForLabel>evidence_file</fieldForLabel>
      <fieldForValue>evidence_file</fieldForValue>
      <search>
        <query>index="virtuoso_tzworks" | top 0 evidence_file</query>
      </search>
    </input>
    <input type="time" token="field1">
      <label>Time Selection:</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
    <input type="text" token="event_keyword">
      <label>Event Keyword:</label>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">UserAssist:</div>
          <br/>
          <b>Description:</b>  GUI-based programs launched from the desktop are tracked in the launcher on a Windows System.<br/>
          <b>Location:</b>  NTUSER.DAT HIVE:   NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count<br/>
          <b>Interpretation:</b>  All values are ROT-13 Encoded:
         <ul>
            <li> GUID for XP: 75048700 Active Desktop   </li>
            <li> GUID for Windows 7/8/10: CEBFF5CD Executable File Execution</li>
            <li> GUID for Windows 7/8/10: F4E57C4B Shortcut File Execution</li>
        </ul>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "$event_keyword$" "extra.tzworks.registry_key"="ntuser.dat/Software/Microsoft/Windows/CurrentVersion/Explorer/UserAssist/?*/Count [enumvalues]"
| stats values(extra.tzworks.item_name) AS "Item Name", values(extra.tzworks.orig_runtime) AS "Original Runtime", values(extra.tzworks.origin_file) AS "Origin File" by extra.tzworks.registry_key, extra.tzworks.subkey</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.registry_key">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.tzworks.registry_key">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.tzworks.subkey">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h3>
          <b>
            <font color="red">Plaso Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_plaso" evidence_file=$evidence_file$ "extra.plaso.parser"="winreg/userassist" "$event_keyword$"
| stats values(provenance.index_timestamp) AS "Timestamp(s)", values(extra.plaso.value_name) AS "Value Names", values(extra.plaso.filename) AS "File Names" by extra.plaso.hostname, winregkey.full</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">15</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.plaso.hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.plaso.hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="winregkey.full">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">Windows 10 Timeline:</div>
      <br/>
          <font color="White">
          <b>Description:  </b>Win10 records recently used applications and files in a “timeline” accessible via the “WIN+TAB” key.  The data is recorded in a SQLite database.<br/>
          <b>Location:  </b>C:\Users\[profile]\AppData\Local\ConnectedDevices Platform\L.[profile]\ActivitiesCache.db<br/>
          <b>Interpretation:  </b>
         <ul>
            <li> Application execution   </li>
            <li> Focus count per application</li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "file.name"=ActivitiesCache "$event_keyword$"
| table _time, timestamp, timestamp_desc, extra.tzworks.type, file.full</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="timestamp_desc">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="timestamp_desc">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.tzworks.type">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h3>
          <b>
            <font color="red">Plaso Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_plaso" evidence_file=$evidence_file$ "file.name"=ActivitiesCache "$event_keyword$"
| table _time, hostname, extra.plaso.display_name, extra.plaso.message</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.plaso.message">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">RecentApps:</div>
      <br/>
          <font color="White">
          <b>Description:  </b>GUI Program execution launched on the Win10 system is tracked in the RecentApps key<br/>
          <b>Location:  </b>Win10:   NTUSER.DAT\Software\Microsoft\Windows\Current  Version\Search\RecentApps<br/>
          <b>Interpretation:  </b>
         <ul>
            <li> Each GUID key points to a recent application.</li>
            <li> AppID = Name of Application</li>
            <li> LastAccessTime = Last execution time in UTC</li>
            <li> LaunchCount = Number of times execute</li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "extra.tzworks.artifact_type"="Shim Cache" "extra.tzworks.registry_key"="HKLM/System/ControlSet001/Control/Session Manager/AppCompatCache/AppCompatCache [enumvalues]" "$event_keyword$"
| table _time, timestamp_desc, extra.tzworks.origin_file, extra.tzworks.pathfile, extra.tzworks.registry_key, file.full</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="color" field="timestamp_desc">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">ShimCache:</div>

      <br/>
          <font color="White">
          <b>Description:  </b>
          <ul>
            <li>  Windows Application Compatibility Database is used by Windows to identify possible application compatibility challenges with executables.</li>
            <li>  Tracks the executables file name, file size, last modified time, and in Windows XP the last update time.</li>
          </ul>
          <b>Location:  </b>XP:   SYSTEM\CurrentControlSet\Control\SessionManager\AppCompatibility<br/> Windows 7/8/10: SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache<br/>
          <b>Interpretation:  </b> Any executable run on the Windows system could be found in this key. You can use this key to identify systems that specific malware was executed on. In addition, based on the interpretation of the time-based data you might be able to determine the last time of execution or activity on the system<br/>
         <ul>
            <li> Windows XP contains at most 96 entries  -   LastUpdateTime is updated when the files are execute</li>
            <li>   Windows 7 contains at most 1,024 entries  - LastUpdateTime does not exist on Win7 systems</li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "extra.tzworks.artifact_type"="Shim Cache" "extra.tzworks.registry_key"="HKLM/System/ControlSet001/Control/Session Manager/AppCompatCache/AppCompatCache [enumvalues]" "$event_keyword$"
| table _time, extra.tzworks.registry_key, file.full</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <format type="color" field="extra.tzworks.registry_key">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">Jump Lists:</div>

      <br/>
          <font color="White">
          <b>Description:  </b>
          <ul>
            <li>  Windows Application Compatibility Database is used by Windows to identify possible application compatibility challenges with executables.</li>
            <li>  Tracks the executables file name, file size, last modified time, and in Windows XP the last update time.</li>
          </ul>
          <b>Location:  </b>XP:   SYSTEM\CurrentControlSet\Control\SessionManager\AppCompatibility<br/> Windows 7/8/10: SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache<br/>
          <b>Interpretation:  </b> Any executable run on the Windows system could be found in this key. You can use this key to identify systems that specific malware was executed on. In addition, based on the interpretation of the time-based data you might be able to determine the last time of execution or activity on the system<br/>
         <ul>
            <li> Windows XP contains at most 96 entries  -   LastUpdateTime is updated when the files are execute</li>
            <li>   Windows 7 contains at most 1,024 entries  - LastUpdateTime does not exist on Win7 systems</li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "extra.tzworks.artifact_type"=JumpList "$event_keyword$"
| table _time extra.tzworks.target_name, extra.tzworks.local_path, extra.tzworks.tgt_access_date_utc, extra.tzworks.tgt_attrib, extra.tzworks.tgt_create_date_utc, extra.tzworks.tgt_modify_date_utc</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="extra.tzworks.target_name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h3>
          <b>
            <font color="red">Plaso Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_plaso" evidence_file=$evidence_file$ "extra.plaso.data_type"="windows:registry:appcompatcache" "$event_keyword$"
| table _time, extra.plaso.message, file.full, extra.plaso.md5_hash, registry_path, registry_modified_time</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">Amcache.hve:</div>

      <br/>
          <font color="White">
          <b>Description:  </b>ProgramDataUpdater (a task associated with the Application Experience Service) uses the registry file Amcache.hve to store data during process creation<br/>
          <b>Location:  </b>Win7/8/10:   C:\Windows\AppCompat\Programs\Amcache.hve<br/>
          <b>Interpretation:  </b> Any executable run on the Windows system could be found in this key. You can use this key to identify systems that specific malware was executed on. In addition, based on the interpretation of the time-based data you might be able to determine the last time of execution or activity on the system<br/>
         <ul>
            <li> Amcache.hve – Keys = Amcache.hve\Root\File\{Volume GUID}\#######</li>
            <li> Entry for every executable run, full path information, File’s $StandardInfo Last Modification Time, and Disk volume the executable was run from</li>
            <li> First Run Time = Last Modification Time of Key</li>
            <li> SHA1 hash of executable also contained in the key</li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ file_name=Amcache.hve* "$event_keyword$"
| table _time, extra.tzworks.type, file.full</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h3>
          <b>
            <font color="red">Plaso Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_plaso" evidence_file=$evidence_file$ extra.plaso.display_name="TSK:/Windows/appcompat/Programs/Amcache.hve" "$event_keyword$"
| table _time, extra.plaso.hostname, extra.plaso.key_path, registry_path, extra.plaso.message</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">System Resource Usage Monitor (SRUM):</div>
      <br/>
          <font color="White">
          <b>Description:  </b>Records 30 to 60 days of historical system performance. Applications run, user account responsible for each, and application and bytes sent/received per application per hour.<br/>
          <b>Location:  </b>SOFTWARE\Microsoft\WindowsNT\CurrentVersion\SRUM\Extensions {d10ca2fe-6fcf-4f6d-848e-b2e99266fa89} = Application Resource Usage Provider C:\Windows\System32\SRU\e<br/>
          <b>Interpretation:  </b> Any executable run on the Windows system could be found in this key. You can use this key to identify systems that specific malware was executed on. In addition, based on the interpretation of the time-based data you might be able to determine the last time of execution or activity on the system<br/>
         <ul>
            <li>Use tool such as <b>srum_dump.exe</b> to cross correlate the data between the registry keys and the SRUM ESE Database. </li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <event>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "SRUM" "$event_keyword$"</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="list.drilldown">full</option>
        <option name="list.wrap">1</option>
        <option name="maxLines">5</option>
        <option name="raw.drilldown">full</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">0</option>
        <option name="table.drilldown">none</option>
        <option name="table.sortDirection">asc</option>
        <option name="table.wrap">1</option>
        <option name="type">table</option>
      </event>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">BAM/DAM:</div>

      <br/>
          <font color="White">
          <b>Description:  </b>Windows Background Activity Moderator (BAM)<br/>
          <b>Location:  </b>
          <ul>Win 10:<li>SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}</li>
          <li>SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}</li>
          </ul>
          <b>Investigative Notes:  </b> Provides full path of the executable file that was run on the system and last execution date/time<br/>
         <ul>
            <li>Use tool such as <b>srum_dump.exe</b> to cross correlate the data between the registry keys and the SRUM ESE Database. </li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "extra.tzworks.registry_key"="HKLM/System/ControlSet001/Services/bam/UserSettings/?* [enumvalues]" "$event_keyword$"
| table _time, extra.tzworks.runtime_utc, extra.tzworks.exe_name, extra.tzworks.sid</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="extra.tzworks.sid">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.tzworks.sid">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
	      <hr style="border:1px solid red;"/>
	      <div style="text-align:center;font-style:bold;color:red;font-size:175%">Last Assisted MRU:</div>

      <br/>
          <font color="White">
          <b>Description:  </b>Tracks the specific executable used by an application to open the files documented in the OpenSaveMRU key. In addition, each value also tracks the directory location for the last file that was accessed by that application. Example: Notepad.exe was last run using the <b>C:\%USERPROFILE%\</b>
          <br/>
          <b>Location:  </b>
          <ul>
            <li>XP:   NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\ LastVisitedMRU</li>
          <li>Win7/8/10:  NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU</li>
          </ul>
          <b>Interpretation:  </b> Tracks the application executables used to open files in OpenSaveMRU and the last file path used.<br/>
         <ul>
            <li>Use tool such as <b>srum_dump.exe</b> to cross correlate the data between the registry keys and the SRUM ESE Database. </li>
        </ul>
        </font>
        <h3>
          <b>
            <font color="red">TZworks Artifacts:</font>
          </b>
        </h3>
    </html>
      <table>
        <search>
          <query>index="virtuoso_tzworks" evidence_file=$evidence_file$ "extra.tzworks.artifact_type"=LastVisitedPidlMRU "$event_keyword$"
| table _time, extra.tzworks.support_name, extra.tzworks.registry_key</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="extra.tzworks.support_name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h3>
          <b>
            <font color="red">Plaso Artifacts:</font>
          </b>
        </h3>
      </html>
      <table>
        <search>
          <query>index="virtuoso_plaso" evidence_file=$evidence_file$ LastVisitedPidlMRU "$event_keyword$"
| table _time,  extra.plaso.hostname, extra.plaso.filename, extra.plaso.message</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.plaso.hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.plaso.hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="extra.plaso.filename">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
</form>

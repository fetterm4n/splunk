<form theme="dark">
  <label>Registry Highlights</label>
  <fieldset submitButton="true" autoRun="true">
    <input type="multiselect" token="evidence_file">
      <label>Evidence File:</label>
      <valuePrefix>evidence_file=</valuePrefix>
      <delimiter>  OR </delimiter>
      <fieldForLabel>evidence_file</fieldForLabel>
      <fieldForValue>evidence_file</fieldForValue>
      <search>
        <query>index="virtuoso_tzworks" | top 0 evidence_file</query>
      </search>
    </input>
    <input type="time" token="time_select">
      <label>Time Selection:</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <font color="yellow">System Attributes</font>
        </b>
        </h1>
      </html>
      <table>
        <title>DHCP Leasing</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ extra.tzworks.artifact_type="DHCP Details" extra.tzworks.dhcp_ipaddress=*
| table
    extra.tzworks.dhcp_ipaddress, extra.tzworks.dhcp_name_server, extra.tzworks.dhcp_server, extra.tzworks.dhcp_subnet_mask, extra.tzworks.enable_dhcp, extra.tzworks.lease_obtained_time, extra.tzworks.lease_terminates_time
    | rename extra.tzworks.dhcp_ipaddress AS "DHCP Address:", extra.tzworks.dhcp_name_server AS "DHCP Name Server", extra.tzworks.dhcp_server AS "DHCP Server:", extra.tzworks.dhcp_subnet_mask AS "Subnet Mask:", extra.tzworks.enable_dhcp AS "Enable DHCP:", extra.tzworks.lease_obtained_time AS "Lease Start:", extra.tzworks.lease_terminates_time AS "Lease Termination:"</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.dhcp_ipaddress">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="DHCP Address:">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Operating System Stats</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ (extra.tzworks.value=BuildLab OR extra.tzworks.value=InstallDate OR extra.tzworks.value=InstallTime OR extra.tzworks.value=ProductName OR extra.tzworks.value=RegisteredOwner OR extra.tzworks.value=SystemRoot OR extra.tzworks.value_name=LastUsedUsername OR extra.tzworks.value_name=TimeZoneKeyName OR extra.tzworks.value_name=NtpServer OR extra.tzworks.value_name=ShutdownTime OR extra.tzworks.value_name=ComputerName OR "extra.tzworks.value_name"=LastUsedUsername)
   | eval Attribute: = coalesce('extra.tzworks.value_name', 'extra.tzworks.value')
   | eval Value: = coalesce('extra.tzworks.value_data', 'extra.tzworks.data')
   | table Attribute:, Value:, extra.tzworks.registry_key
   | rename extra.tzworks.registry_key AS "Registry Key:"
   | sort +Attribute</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.value">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Attribute:">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Attribute">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <font color="Red">Security Attributes</font>
        </b>
        </h1>
      </html>
      <table>
        <title>Security Account Management</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ extra.tzworks.artifact_type=UserAccts
| table extra.tzworks.username, extra.tzworks.logins, extra.tzworks.last_logon_date_utc, extra.tzworks.last_failed_utc, extra.tzworks.other_account_data
| rename extra.tzworks.username AS "Username:", extra.tzworks.logins AS "Logins:", extra.tzworks.last_logon_date_utc AS "Last Logon:", extra.tzworks.last_failed_utc AS "Last Failed Logon:" extra.tzworks.other_account_data AS "Account Data:"</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.logins">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Logins:">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="extra.tzworks.logins">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Logins:">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="extra.tzworks.logins">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Logins:">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="extra.tzworks.logins">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Logins:">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Account Data:">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Audit Policies</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ (extra.tzworks.artifact_type="AuditPolicy")
| table extra.tzworks.policy_name, extra.tzworks.type_audit
| rename extra.tzworks.policy_name AS "Audit Policy", extra.tzworks.type_audit AS "Audit Type"
| sort -"Audit Type"</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">50</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Audit Policy">
          <colorPalette type="map">{"no auditing":#AF575A,"success auditing":#90EE90,"success &amp; failure auditing":#00D33D}</colorPalette>
        </format>
        <format type="color" field="Audit Policy">
          <colorPalette type="map">{"no auditing":#AF575A,"success auditing":#90EE90,"success &amp; failure auditing":#00D33D}</colorPalette>
        </format>
        <format type="color" field="Audit Type">
          <colorPalette type="map">{"success auditing":#53A051,"success &amp; failure auditing":#62B3B2,"no auditing":#AF575A}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Driver Signing Policy</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"="Driver Signing policy"
| table extra.tzworks.artifact_type, extra.tzworks.policy</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.policy">
          <colorPalette type="map">{"Not Set":#AF575A}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Firewall Policy</title>
      <input type="text" token="fw_policy_search" searchWhenChanged="true">
        <label>Firewall Policy Search:</label>
        <default>*</default>
        <prefix>*</prefix>
        <suffix>*</suffix>
        <initialValue>*</initialValue>
      </input>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"="Firewall Policy"
| rex "(?&lt;Action&gt;(Action[^|]+))"
| rex "(?&lt;Active&gt;Active=([^|]+))"
| rex "(?&lt;Direction&gt;Dir=([^|]+))"
| table extra.tzworks.value_name, Action, Active, Direction, extra.tzworks.value_data
| sort -Active</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">50</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="color" field="Active">
          <colorPalette type="map">{"Active=TRUE":#66ccff,"Active=FALSE":#808080}</colorPalette>
        </format>
        <format type="color" field="Direction">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Action">
          <colorPalette type="map">{"Action=Allow":#99ff99,"Action=Deny":#708794}</colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <font color="Orange">Program Execution</font>
        </b>
        </h1>
      </html>
      <table>
        <title>Background Activity Manager</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ extra.tzworks.artifact_type="Background Activity Moderator"
| table extra.tzworks.runtime_utc, extra.tzworks.exe_name, extra.tzworks.sid
| sort -extra.tzworks.runtime_utc</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.sid">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Shim cache / Amcache Modification Timeline</title>
        <search>
          <query>index="virtuoso_tzworks" (extra.tzworks.artifact_type="Shim Cache" OR extra.tzworks.artifact_type="Amcache InventoryApplicationFile")
| timechart count by extra.tzworks.artifact_type</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Events</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">1</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">0</option>
        <option name="trellis.size">large</option>
        <option name="trellis.splitBy">extra.tzworks.artifact_type</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Amcache Entries</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ extra.tzworks.artifact_type="Amcache InventoryApplicationFile"
| streamstats count as Id
| stats values(*) as * by Id
| table timestamp, extra.tzworks.*
| fields - extra.tzworks.csv_src, extra.tzworks.origin_file, extra.tzworks.tool_used, extra.tzworks.orig_runtime, extra.tzworks.dynamic_info, extra.tzworks.artifact_type
| sort +timestamp</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
      </table>
    </panel>
    <panel>
      <title>Shimcache Entries</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ extra.tzworks.artifact_type="Shim Cache"
| streamstats count as Id
| stats values(*) as * by Id
| table extra.tzworks.file_modify_utc, extra.tzworks.*
| fields - extra.tzworks.csv_src, extra.tzworks.origin_file, extra.tzworks.tool_used, extra.tzworks.orig_runtime, extra.tzworks.dynamic_info, extra.tzworks.artifact_type timestamp
| sort +extra.tzworks.file_modify_utc</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Services with Start:  5 Most Recent</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"="Services with start"
| table timestamp, timestamp_desc, extra.tzworks.image_path,
| rename timestamp_desc AS Description, extra.tzworks.image_path AS "Image Path"
| sort -timestamp</query>
          <earliest>$time_select.earliest$</earliest>
          <latest>$time_select.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Remote RPC Configuration</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"="Terminal Server Info"
| search (extra.tzworks.value_name="AllowRemoteRPC" OR extra.tzworks.value_name="fDenyTSConnections" OR extra.tzworks.value_name="fSingleSessionPerUser")
| table extra.tzworks.value_name, extra.tzworks.value_data</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="extra.tzworks.value_data">
          <colorPalette type="map">{"0x00000001 (1)":#62B3B2,"0x00000000 (0)":#708794}</colorPalette>
        </format>
        <format type="color" field="extra.tzworks.value_data">
          <colorPalette type="map">{"0x00000001 (1)":#62B3B2,"0x00000000 (0)":#708794}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Boot Execute</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"="Bootexecute" "extra.tzworks.boot_execute"!="autocheck autochk *"
| table extra.tzworks.boot_execute</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <font color="Green">Users and Profiles</font>
        </b>
        </h1>
      </html>
      <table>
        <title>Profiles</title>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.artifact_type"=ProfileList
| table extra.tzworks.profile_image_path, extra.tzworks.subkey</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Shell Folders / Common Startup</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ "extra.tzworks.subkey"="Shell Folders"
| table extra.tzworks.value_name, extra.tzworks.startup_partial_string</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>User Hives -- need to figure out how to isolate username</title>
      <table>
        <search>
          <query>index="virtuoso_tzworks" $evidence_file$ provenance.command_id=tzworks.user
(extra.tzworks.artifact_type=UserInfo OR extra.tzworks.artifact_type=Run OR extra.tzworks.artifact_type=RunOnce OR extra.tzworks.artifact_type="Internet Settings" OR extra.tzworks.artifact_type="UserAssist" OR extra.tzworks.artifact_type="RecentApps" OR extra.tzworks.artifact_type="RecentDocs")
| stats values(extra.tzworks.registry_key) by extra.tzworks.artifact_type</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>

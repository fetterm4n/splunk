<form theme="dark">
  <label>Periodicity City</label>
  <description>Identify beaconing / periodicity in by searching for low variance between netflows and regular intervals</description>
  <fieldset submitButton="true" autoRun="true">
    <input type="dropdown" token="index">
      <label>Index</label>
      <fieldForLabel>index</fieldForLabel>
      <fieldForValue>index</fieldForValue>
      <search>
        <query>| tstats values(sourcetype) by index</query>
        <earliest>0</earliest>
        <latest></latest>
      </search>
      <default>ics</default>
    </input>
    <input type="text" token="flows">
      <label>Minimum Flows</label>
      <default>2</default>
      <initialValue>2</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Top Candidates by Source IP</title>
        <search base="periodicity_base">
          <query>| stats count by src_ip | table src_ip, count | sort -count | head 5</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#53A051" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="src_ip">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <table>
        <title>Top Candidates by Dest IP</title>
        <search base="periodicity_base">
          <query>| stats count by dest_ip | table dest_ip, count | sort -count | head 5</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#53A051" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="dest_ip">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <search id="periodicity_base">
          <query>index=$index$
| streamstats current=f last(_time) as next_time by src_ip, dest_ip
| eval gap=next_time - _time
| stats values(dest_port), count AS Flows, avg(gap) AS Avg_Interval, var(gap) AS Variance by src_ip, dest_ip
| sort +Variance
| search Flows&gt;$flows$ AND Avg_Interval &gt; 0</query>
          <earliest>0</earliest>
          <latest></latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="number" field="AVG_Gap"></format>
        <format type="color" field="dst_ip">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="src_ip">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
</form>
